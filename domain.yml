version: "3.1"

intents:
  # Core conversational
  - greet
  - affirm
  - deny
  - goodbye
  - thank
  - chitchat
  - out_of_scope
  - confused
  
  # Report management
  - start_report
  - stop_reporting
  - want_to_skip
  - continue_previous_report
  - need_break
  - ready_to_continue
  - withdraw_consent
  - happening_now          
  - take_break             
  - continue_report        
  - submit_report
  
  # Incident description
  - provide_incident_details
  - describe_physical_violence
  - describe_sexual_violence
  - describe_emotional_abuse
  - describe_economic_abuse
  - describe_multiple_types
  - describe_online_gbv
  
  # Location & time
  - provide_location
  - location_unsafe_to_share
  - recent_incident
  - ongoing_situation
  
  # Perpetrator information
  - intimate_partner
  - ex_partner
  - family_member
  - stranger
  - authority_figure
  - prefer_not_say_perpetrator
  
  # Emotional states
  - express_distress
  - report_emergency
  - express_fear
  - express_shame
  - express_overwhelm
  - express_numbness
  - panic_crisis
  
  # Support needs
  - need_immediate_safety
  - need_medical_care
  - need_legal_help
  - need_counseling
  - need_shelter
  - request_resources
  
  # Resources
  - ask_about_resources
  - search_medical_facilities
  - search_legal_services
  - search_counseling_services
  - search_shelter_options
  - search_police_stations
  - ask_national_hotlines
  - ask_resources_by_county
  - ask_about_costs
  - ask_about_hours
  
  # Barriers
  - fear_retaliation
  - dont_trust_police
  - family_pressure
  - economic_dependence
  - stigma_concern
  
  # Clarification
  - ask_why_question

entities:
  - county
  - incident_type
  - timeframe
  - relationship

slots:
  # === FORM SLOTS (Required for reporting) ===
  consent_given:
    type: bool
    initial_value: null
    influence_conversation: true
    mappings:
    - type: custom
      action: action_save_consent

  detected_emotion:
    type: text
    influence_conversation: true
    mappings:
    - type: custom
  
  is_report_initiation:
    type: bool
    initial_value: false
    influence_conversation: true
    mappings:
    - type: custom
  
  report_submitted:
    type: bool
    initial_value: false
    influence_conversation: false
    mappings:
    - type: custom    

  incident_type:
    type: text
    influence_conversation: true
    mappings:
    - type: from_intent
      intent: describe_physical_violence
      value: "physical_violence"
    - type: from_intent
      intent: describe_sexual_violence
      value: "sexual_violence"
    - type: from_intent
      intent: describe_emotional_abuse
      value: "emotional_abuse"
    - type: from_intent
      intent: describe_economic_abuse
      value: "economic_abuse"
    - type: custom

  timeframe:
    type: text
    influence_conversation: false
    mappings:
    - type: from_intent
      intent: recent_incident
      value: "recent"
    - type: from_intent
      intent: ongoing_situation
      value: "ongoing"
    - type: custom

  county:
    type: text
    influence_conversation: false
    mappings:
    - type: from_entity
      entity: county
    - type: custom

  relationship_to_perpetrator:
    type: text
    influence_conversation: false
    mappings:
    - type: from_intent
      intent: intimate_partner
      value: "intimate_partner"
    - type: from_intent
      intent: ex_partner
      value: "ex_partner"
    - type: from_intent
      intent: family_member
      value: "family_member"
    - type: from_intent
      intent: stranger
      value: "stranger"
    - type: from_intent
      intent: authority_figure
      value: "authority_figure"
    - type: from_intent
      intent: prefer_not_say_perpetrator
      value: "prefer_not_to_say"
    - type: custom

  support_needs:
    type: list
    influence_conversation: false
    mappings:
    - type: custom

  # === TRACKING SLOTS ===
  requested_slot:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

  report_in_progress:
    type: bool
    initial_value: false
    influence_conversation: true
    mappings:
    - type: custom

  needs_immediate_safety:
    type: bool
    initial_value: false
    influence_conversation: true
    mappings:
    - type: custom

  distress_level:
    type: categorical
    values:
      - calm
      - mild
      - moderate
      - severe
      - crisis
    influence_conversation: true
    mappings:
    - type: custom

  session_id:
    type: text
    influence_conversation: false
    mappings:
    - type: custom
  
  user_id:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

# === FORMS (This prevents looping!) ===
forms:
  incident_report_form:
    required_slots:
      - consent_given
      - incident_type
      - timeframe
      - county
      - relationship_to_perpetrator
      - support_needs

responses:
  # === CORE RESPONSES ===
  utter_greet:
  - text: "Habari. I'm Vee, and I'm here to support you in a safe, confidential space. Everything we discuss is anonymous."

  utter_goodbye:
  - text: "Take care of yourself. Remember, help is available 24/7: Emergency 999 or GBV Helpline 1195. You are not alone."

  utter_thank:
  - text: "You're welcome. Thank you for your courage in reaching out."

  utter_chitchat:
  - text: "I'm here specifically to support you with reporting GBV incidents and connecting you to resources. How can I help you today?"

  utter_out_of_scope:
  - text: "I'm specifically designed to help with reporting gender-based violence incidents. Would you like to start a report or get information about support services?"

  # === CONSENT ===
  utter_ask_consent:
  - text: |
      Before we begin, I want you to know:
      â€¢ This conversation is completely anonymous
      â€¢ You can stop at any time
      â€¢ You control what you share
      
      Do you consent to proceed?

  # === FORM QUESTIONS ===
  utter_ask_incident_type:
  - text: "When you're ready, you can share what happened in your own words. There's no rush, and you can share as much or as little as feels right."
  - text: "If you're comfortable, could you tell me what type of incident this was? Take your time."

  utter_ask_timeframe:
  - text: "When did this happen? You can be as specific or general as you feel comfortable."
  - text: "If it's okay to share, when did this take place?"

  utter_ask_county:
  - text: "Where did this happen? Knowing the general area helps connect you to nearby support services. You can share just the county or skip this if it feels unsafe."

  utter_ask_relationship_to_perpetrator:
  - text: "If you're comfortable sharing, what is your relationship to the person who did this? You can skip this question if you prefer."

  utter_ask_support_needs:
  - text: |
      What kind of support would be most helpful for you right now?
      â€¢ Medical care
      â€¢ Legal assistance
      â€¢ Counseling
      â€¢ Safe shelter
      â€¢ Just information

  # === ACKNOWLEDGMENTS ===
  utter_acknowledge_incident_type:
  - text: "Thank you for sharing that with me. I know this takes courage."

  utter_not_your_fault:
  - text: "What happened is not your fault. You deserve support and safety."

  utter_acknowledge_timing:
  - text: "Thank you for telling me when this happened."

  utter_acknowledge_location:
  - text: "Thank you for sharing that information."

  utter_acknowledge_relationship:
  - text: "I understand. Thank you for telling me."

  # === SAFETY & EMERGENCY ===
  utter_emergency_response:
  - text: |
      ðŸš¨ If you are in immediate danger:
      â€¢ Call 999 (Police Emergency)
      â€¢ Call 1195 (GBV Helpline - 24/7)
      â€¢ Go to the nearest police station or safe place
      
      Would you like me to help you find nearby support services?

  # === CONTROL & CONSENT ===
  utter_skip_question:
  - text: "No problem at all. You don't have to answer anything you're not comfortable with. Let's move forward."

  utter_stop_reporting:
  - text: "I've stopped the reporting process. Your wellbeing comes first. If you'd like to continue later, you can come back anytime. Take care."

  utter_withdraw_consent:
  - text: "I understand. Take care of yourself."

  # === EMOTIONAL SUPPORT ===
  utter_respond_to_fear:
  - text: "It's normal to feel afraid. Your safety is important. Let's take a moment. Can you name 3 things you can see right now?"

  utter_respond_to_shame:
  - text: "You have nothing to be ashamed of. You're incredibly brave."

  utter_respond_to_overwhelm:
  - text: "I hear this is overwhelming. Would you like to take a break?"

  utter_offer_break:
  - text: "Would you like to take a break? Your wellbeing comes first."

  # === COMPLETION ===
  utter_report_submitted:
  - text: "Your report has been submitted anonymously. Thank you for your courage."

  utter_provide_next_steps:
  - text: |
      Here are your next steps:
      â€¢ Medical care: Within 72 hours for PEP
      â€¢ Legal: FIDA Kenya 0800 720 553 (Free)
      â€¢ Counseling: 1190 or 0722 178177 (24/7)
      ðŸš¨ Emergency: 1195 or 999

  # === RESOURCES ===
  utter_explain_free_services:
  - text: |
      Many services are FREE for GBV survivors:
      â€¢ FIDA Kenya legal aid (0800 720 553)
      â€¢ Public hospital GBV units
      â€¢ National hotlines (1195, 999, 116)
      â€¢ Police gender desks
      
      Don't let cost prevent you from getting help.

  # === CLARIFICATION ===
  utter_explain_data_use:
  - text: |
      The information you share helps:
      â€¢ Identify areas that need more support services
      â€¢ Show patterns that inform policy
      â€¢ Connect you to nearby resources
      
      Your personal details are never shared. All reports are anonymous and encrypted.

  utter_clarify:
  - text: "Let me explain that better. You can share what happened at your own pace, skip any question, or stop anytime. What would you like to know?"

  utter_affirm_courage:
  - text: "Thank you for your courage. Let's begin when you're ready."
  
  utter_ask_what_happened:
  - text: "When you're ready, can you tell me what happened? Take your time."
  
  utter_ask_when_happened:
  - text: "When did this happen? You can be as specific or general as you feel comfortable."
  
  utter_ask_where_happened:
  - text: "Where did this happen? Knowing the area helps connect you to nearby support."
  
  utter_ask_who_perpetrator:
  - text: "If you're comfortable, what is your relationship to the person who did this?"
  
  utter_ask_reporting_barriers:
  - text: "What concerns or barriers do you have about seeking help?"
  
  utter_check_in:
  - text: "How are you feeling right now? Do you need a moment?"
  
  utter_provide_medical_resources:
  - text: "Medical care is available. Go within 72 hours for PEP. GBV helpline: 1195"
  
  utter_provide_legal_resources:
  - text: "FIDA Kenya provides free legal aid: 0800 720 553"
  
  utter_provide_counseling_resources:
  - text: "Free counseling: LVCT Health 1190, Befrienders 0722 178177"
  
  utter_provide_shelter_resources:
  - text: "Safe shelter available. GBV Helpline 1195 can connect you to safe houses."
  
  utter_save_progress:
  - text: "Your progress is saved. You can continue anytime. Stay safe."
  
  utter_report_almost_complete:
  - text: "We're almost done. You're doing great. Ready to continue?"
  
  utter_5_4_3_2_1:
  - text: "Let's ground together. Name: 5 things you see, 4 you can touch, 3 you hear, 2 you smell, 1 you taste."
  
  utter_grounding_prompt:
  - text: "Let's take a moment. Can you name 3 things you can see right now?"
  
  utter_crisis_response:
  - text: "ðŸš¨ If you're in immediate danger: Police 999, GBV Helpline 1195. Are you safe right now?"
  
  utter_ask_county_for_resources:
  - text: "Which county are you in? This helps me find nearby resources."
  
  utter_default:
  - text: "I'm here to listen. Can you tell me more?"

  utter_provide_immediate_safety:
  - text: "ðŸš¨ Emergency: Police 999, GBV Helpline 1195. Are you safe right now?"
  
  utter_respect_skip:
  - text: "That's okay. You don't have to answer. Let's move on."
  
  utter_acknowledge_barriers:
  - text: "Thank you for sharing. These are real concerns." 

  utter_provide_resources:
  - text: |
      Here are resources that can help:
      â€¢ Emergency: Police 999, GBV Helpline 1195
      â€¢ Medical: Public hospitals (free PEP within 72 hours)
      â€¢ Legal: FIDA Kenya 0800 720 553 (free legal aid)
      â€¢ Counseling: LVCT Health 1190, Befrienders 0722 178177
      â€¢ Shelter: GBV Helpline 1195 can connect you to safe houses
      
      Would you like me to help you find specific services in your county?

  
actions:
  # Session management
  - action_generate_session_id
  - action_save_consent
  - action_restore_session
  - action_save_progress
  

  # Form validation
  - validate_incident_report_form

  # Data collection
  - action_collect_incident_details
  - action_collect_temporal_info
  - action_collect_location
  - action_collect_perpetrator_info
  - action_collect_support_needs
  - action_collect_barriers

  
  # Emotional support
  - action_check_distress_level
  - action_assess_safety
  - action_grounding_exercise
  - action_calculate_progress
  
  # Resources
  - action_provide_resources
  - action_get_national_hotlines
  - action_search_county_resources
  - action_search_medical_facilities
  - action_search_legal_services
  - action_search_counseling_services
  - action_search_shelters
  - action_explain_resource_costs
  - action_validate_county
  - action_get_all_counties
  - action_search_police_stations 
  
  # Report management
  - action_submit_report
  
  # NLP Integration
  - action_analyze_with_nlp
  - action_submit_to_backend

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true