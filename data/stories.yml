version: "3.1"

stories:
  # ===== MAIN HAPPY PATH =====
  - story: complete report flow
    steps:
      - intent: greet
      - action: utter_greet
      - action: action_generate_session_id
      - intent: start_report
      - action: utter_ask_consent
      - intent: affirm
      - action: action_save_consent
      - action: utter_affirm_courage
      - action: utter_ask_what_happened
      - intent: describe_physical_violence
      - action: action_collect_incident_details
      - action: utter_ask_when_happened
      - intent: recent_incident
      - action: action_collect_temporal_info
      - action: utter_ask_where_happened
      - intent: provide_location
        entities:
          - county: "Nairobi"
      - action: action_collect_location
      - action: utter_ask_who_perpetrator
      - intent: intimate_partner
      - action: action_collect_perpetrator_info
      - action: utter_ask_support_needs
      - intent: need_medical_care
      - action: action_collect_support_needs
      - action: utter_ask_reporting_barriers
      - intent: fear_retaliation
      - action: action_collect_barriers
      - action: utter_report_almost_complete
      - intent: submit_report
      - action: action_submit_report
      - action: utter_provide_next_steps

  # ===== SEXUAL VIOLENCE REPORT =====
  - story: sexual violence report
    steps:
      - intent: start_report
      - action: utter_ask_consent
      - intent: affirm
      - action: action_save_consent
      - action: utter_ask_what_happened
      - intent: describe_sexual_violence
      - action: action_collect_incident_details
      - action: utter_ask_when_happened
      - intent: recent_incident
      - action: action_collect_temporal_info
      - action: utter_ask_where_happened

  # ===== EMOTIONAL ABUSE REPORT =====
  - story: emotional abuse report
    steps:
      - intent: start_report
      - action: utter_ask_consent
      - intent: affirm
      - action: action_save_consent
      - action: utter_ask_what_happened
      - intent: describe_emotional_abuse
      - action: action_collect_incident_details
      - action: utter_ask_when_happened
      - intent: ongoing_situation
      - action: action_collect_temporal_info
      - action: utter_ask_where_happened

  # ===== ECONOMIC ABUSE REPORT =====
  - story: economic abuse report
    steps:
      - intent: start_report
      - action: utter_ask_consent
      - intent: affirm
      - action: action_save_consent
      - action: utter_ask_what_happened
      - intent: describe_economic_abuse
      - action: action_collect_incident_details
      - action: utter_ask_when_happened
      - intent: ongoing_situation
      - action: action_collect_temporal_info
      - action: utter_ask_where_happened

  # ===== CONSENT DENIAL =====
  - story: user denies consent
    steps:
      - intent: start_report
      - action: utter_ask_consent
      - intent: deny
      - action: action_save_consent
      - action: utter_withdraw_consent

  # ===== RESOURCE ONLY REQUESTS =====
  - story: just need resources
    steps:
      - intent: greet
      - action: utter_greet
      - action: action_generate_session_id
      - intent: request_resources
      - action: action_provide_resources

  - story: search specific county resources
    steps:
      - intent: ask_resources_by_county
      - action: utter_ask_county_for_resources
      - intent: provide_location
        entities:
          - county: "Nairobi"
      - action: action_validate_county
      - action: action_search_county_resources

  # ===== PERPETRATOR RELATIONSHIPS =====
  - story: perpetrator is family with counseling need
    steps:
      - intent: start_report
      - action: utter_ask_consent
      - intent: affirm
      - action: action_save_consent
      - action: utter_ask_what_happened
      - intent: describe_sexual_violence
      - action: action_collect_incident_details
      - action: utter_ask_when_happened
      - intent: recent_incident
      - action: action_collect_temporal_info
      - action: utter_ask_where_happened
      - intent: provide_location
        entities:
          - county: "Nairobi"
      - action: action_collect_location
      - action: utter_ask_who_perpetrator
      - intent: family_member
      - action: action_collect_perpetrator_info
      - action: utter_ask_support_needs
      - intent: need_counseling
      - action: action_collect_support_needs

  - story: perpetrator is ex-partner with legal need
    steps:
      - intent: start_report
      - action: utter_ask_consent
      - intent: affirm
      - action: action_save_consent
      - action: utter_ask_what_happened
      - intent: describe_emotional_abuse
      - action: action_collect_incident_details
      - action: utter_ask_when_happened
      - intent: ongoing_situation
      - action: action_collect_temporal_info
      - action: utter_ask_where_happened
      - intent: provide_location
        entities:
          - county: "Nairobi"
      - action: action_collect_location
      - action: utter_ask_who_perpetrator
      - intent: ex_partner
      - action: action_collect_perpetrator_info
      - action: utter_ask_support_needs
      - intent: need_legal_help
      - action: action_collect_support_needs

  # ===== EMOTIONAL SUPPORT STORIES (NOW CONSISTENT) =====
  - story: user expresses distress during report
    steps:
      - intent: start_report
      - action: utter_ask_consent
      - intent: affirm
      - action: action_save_consent
      - action: utter_ask_what_happened
      - intent: express_distress
      - action: action_check_distress_level
      - action: utter_respond_to_overwhelm
      - action: utter_offer_break

  - story: user expresses fear
    steps:
      - intent: express_fear
      - action: action_check_distress_level
      - action: utter_respond_to_fear

  - story: user expresses shame
    steps:
      - intent: express_shame
      - action: action_check_distress_level
      - action: utter_respond_to_shame

  - story: user expresses overwhelm
    steps:
      - intent: express_overwhelm
      - action: action_check_distress_level
      - action: utter_respond_to_overwhelm

  - story: user expresses numbness
    steps:
      - intent: express_numbness
      - action: action_check_distress_level
      - action: utter_grounding_prompt

  # ===== BREAKS & PAUSES (NOW CONSISTENT) =====
  - story: user needs break
    steps:
      - intent: need_break
      - action: action_save_progress
      - action: utter_save_progress

  - story: user takes break
    steps:
      - intent: take_break
      - action: action_save_progress
      - action: utter_save_progress

  # ===== SKIPPING QUESTIONS (NOW CONSISTENT) =====
  - story: user wants to skip question
    steps:
      - action: utter_ask_what_happened
      - intent: want_to_skip
      - action: utter_skip_question
      - action: utter_ask_when_happened

  - story: prefer not to say perpetrator
    steps:
      - action: utter_ask_who_perpetrator
      - intent: prefer_not_say_perpetrator
      - action: utter_skip_question
      - action: utter_ask_support_needs

  - story: location unsafe to share
    steps:
      - action: utter_ask_where_happened
      - intent: location_unsafe_to_share
      - action: utter_skip_question
      - action: utter_ask_who_perpetrator

  # ===== BARRIERS & CONCERNS =====
  - story: user doesn't trust police
    steps:
      - intent: dont_trust_police
      - action: utter_acknowledge_barriers
      - action: utter_provide_resources

  - story: user has economic dependence
    steps:
      - intent: economic_dependence
      - action: utter_acknowledge_barriers
      - action: utter_provide_resources

  # ===== SIMPLE INTERACTIONS =====
  - story: just greeting
    steps:
      - intent: greet
      - action: utter_greet
      - action: action_generate_session_id

  - story: goodbye
    steps:
      - intent: goodbye
      - action: utter_goodbye

  - story: thank you
    steps:
      - intent: thank
      - action: utter_thank